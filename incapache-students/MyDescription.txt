Laboratorio 24/11
Parte obbligatoria 5.0 -->Http 1.0
Parte opzionale 5.1 -->Http 1.1

Htpp 1.0 connessioni non persistenti

incApache_main
è orgranizzato l'avvio del processo.
Inizialmente viene attivato un processo che è destinato a diventare server e poi attraverso una fork viene creato un ulteriore 
processo ausiliario che esegue l'applicazione FILE -i.
Questi due processi sono collegati tramite due PIPE.
L'applicazione server viene creata dal makefile usando il comando sudo per poter attribuire il file all'utente root in modo che 
chiunque possa mandare in esecuzione questo processo con effectiveUserID=0. Infatti viene chiesta la password.
Se non abbiamo la possiblità di usare sudo per dare i privilegi di amministrazione al server possiamo compilarlo lostesso 
con prettend to be root (salta la fase legata bit set-user-id).
Usando il makefile di defoult è attiva la funzione di DEBUG e non è attiva la compilazione della versione 5.1.

La direcotry bin contiene gli eseguibili nostri e 4 precompilati: due versioni diverse per ogni versione, 
una con il DEBUG attivato e una senza.

La directory www-root troviamo file che possono essere utilizzati per provare a utilizzare il server.
Il server deve essere mandato in esecuzione con il nome della direcotry su cui deve essere attivato (www-root).


incApache_threads
Implementazione del meccanismo multi-thread.
Il server è multi-thread in entrambi le versioni, quello che cambia è il numero di thread che vengono attivati.
Nella versione 5.0 1 thread attivato per ogni connessione da parte di un client.


incApache_aux
Implemeta l'orgranizzazione delle date nel formato standard GMP.
Ci sarà da leggere il manuale...
Una funzione da implementare serve per il meccanismo del conditional-GET : la possiblità di rispondere ad un 
metodo GET con l'opzione if-modified-since effettuando il confrotno tra due date per decidere se rispondere 
200 OK o 304 Not Modified


incApache_http
Parte piu difficile...
Ci sono due funzioni pricipali: una che serve per fare il parsing delle richieste provenienti dai client, 
una che server per rispondere al client.
Ci sono funzioni ausiliarie che servono per gestire il meccanismo dei cookie.
I cookie vengono usati dal server per tracciare i clietn:
Tutte le volete che mi contatta con client vado a vedere se ha già un cookie di tracciaento altrimenti
devo produrne uno nuovo (ID=1). 
Un cookie di tracciamneto è un ID il quale corrisponde a un contatore alloca in un array, che tiene il cotno del numero di 
richieste effettuate da quel client.
!!!!I cookie devono essere persistenti!!!!
Organizzazione:
E' stato definito un array di dimensioni predefinite, ci sarà la necessità di fare operazioni di incremento modulo la dimensione 
dell array.

Nel parsing delle richieste abbiamo 
- una prima riga che contiene il metodo (GET/HEAD/altrimenti "MethodNotimplement"), 
    il nome del file (dovrà essere poi passato al processo aux per ottenere il MIME TYPE e usato per aprire la struttura Stat contenente i metadati) 
    e la verisone (Http 1.0)
- if-modified-seice: data GMP //se presente confronto le date...
- Cookie: UserId=5 //se presente devo tracciare l'utente numero 5 aumentanot il contatore, altrimenti assegno un nuovo ID a quel client.

Le segnalazioni di errore corrispondoo a mandare una ripsota del tipo 400quaclosa e inviare un file in cui c'è la spiegazione

Nel parsing della risposta.
Ci deve essere 
- il risultato della risposta e ella richiesta sottofomra di numero ASCII
- parti opzionali che possono contenere gli header che dicono Mime-Type, Last modified e la lunghezza del file.
- riga vuota
- body che contiene un file e si deve usare la sendifile() facendo attenzione all condizioni di errore...


Per entrambe le versioni sarà indispensabile fare una debugging adeguato: mettere il programma in condizioni in cui possono
attivati thread multipli contemporaneamente, in modo da rilevare sperimentalmente la presenza di corse critiche.
La condizione la abbiamo mandando tante richieste di connessione simultanee.
Tipicamente il browser arpre piu connessioni contemporaneamente colìn lo stesso server, quidni è interessante utilizzare 
file.html che contegono tante immagini.
Un altro modo sarebbe quello di prepararsi uno script.

















bin/incapache5.0debug-ubuntu64 www-root 80 file -i
index.html

chamod 644 per tornare all'eseguibile originale
abilitare permetssi per eseguibili di chiola
sudo chown root incapache5.0debug-ubuntu64
 sudo chmod +x incapache5.0debug-ubuntu64
 sudo chmod u+s incapache5.0debug-ubuntu64
 bin/incapache5.0-ubuntu64 www-root 80